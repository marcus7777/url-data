<!doctype html>
<html>
  <head>
    <title>url-data</title>
    <script src="../../webcomponentsjs/webcomponents.js"></script>
    <script src="../../web-component-tester/browser.js"></script>
    <script src="../../test-fixture/test-fixture-mocha.js"></script>
    <script src="../../iron-test-helpers/mock-interactions.js"></script>
    <link rel="import" href="../../polymer/polymer.html">
    <link rel="import" href="../../test-fixture/test-fixture.html">
    <link rel="import" href="../url-data.html">
  </head>
  <body>
    <test-fixture id="urlData">
      <template>
        <url-data></url-data>
      </template>
    </test-fixture>
    <script>
      suite('<url-data>', function () {
        var urlData
        setup(function () {
          urlData = fixture('urlData')
        })
        suite('Decode', function () {
          test('Decode string', function(done) {
            urlData.set("string", "~(e~'*7b*22data*22*3a*220173633234Z3133Z33884Z72344Z73654Z65444Z22344Z113498*22*7d~Z~'4*2c01736)")
            if (urlData.dataFromString.data === "01736332344,0173631334,01736338844,01736723444,01736736544,01736654444,01736223444,01736113498") {
              done()
            }
          })
        })
        suite('Encode', function () {
          test('Encode Small', function(done) {
            urlData.set("data", {testing:"123"})
            if (urlData.stringFromData === "~(testing~'123)") {
              done()
            }
          })
          test('Encode Medium', function(done) {
            urlData.set("data","JSURL\r\n\r\nJSURL is an alternative to JSON + URL encoding (or JSON + base64 encoding). It makes it handy to pass complex values via URL query parameters.\r\n\r\nJSURL has been designed to be:\r\n\r\nCompact: its output is much more compact than JSON + URL encoding (except in pathological cases). It is even often slightly more compact than regular JSON!\r\nReadable: its output is much more readable than JSON + URL encoding.\r\nFoolproof: its output only contains characters that are unaffected by URL encoding\/decoding. There is no risk of missing a URL encoding\/decoding pass, or of messing up a JSURL string by applying an extra URL encoding or decoding pass.\r\nEasy to generate and parse\r\nSyntax\r\n\r\nThink of it as JSON with the following changes:\r\n\r\nCurly braces ({ and }) replaced by parentheses (( and ))\r\nSquare brackets ([ and ]) replaced by (~ and )\r\nProperty names unquoted (but escaped -- see below).\r\nString values prefixed by a single quote (\') and escaped\r\nAll other JSON punctuation (colon : and comma ,) replaced by tildes (~)\r\nAn extra tilde (~) at the very beginning.\r\nProperty names and string values are escaped as follows:\r\n\r\nLetters, digits, underscore (_), hyphen (-) and dot (.) are preserved.\r\nDollar sign ($) is replaced by exclamation mark (!)\r\nOther characters with UNICODE value <= 0xff are encoded as *XX\r\nCharacters with UNICODE value > 0xff are encoded as **XXXX\r\nExamples\r\n\r\nJSON:\r\n\r\n{\"name\":\"John Doe\",\"age\":42,\"children\":[\"Mary\",\"Bill\"]}\r\nJSON + URL encoding:\r\n\r\n%7B%22name%22%3A%22John%20Doe%22%2C%22age%22%3A42%2C%22children%22%3A%5B%22Mary%22%2C%22Bill%22%5D%7D\r\nJSURL:\r\n\r\n~(name~\'John*20Doe~age~42~children~(~\'Mary~\'Bill))\r\n")
            if (urlData.stringFromData === "~(1~'*20JSON~8~'*20and*20~9~'*20URL*20encoding~e~'JSURL*0d*0a*0d*0aJSURLWan*20alternative*20to1*20*2b9*20*28or1*20*2b*20base64*20encodZ*29.*20It*20makGit*20handy*20to*20pass*20complex*20valuGvia*20URL*20query*20parameters.*0d*0a*0d*0aJSURL*20has*20been*20designQto*20be*3a*0d*0a*0d*0aCompact*3a*20its*20outputWmuchY1*20*2b9*20*28except*20in*20pathological*20cases*29.*20ItWeven*20often*20slightlyY*20regular1*21*0d*0aReadable*3a*20its*20outputWmuch*20moVreadable*20than1*20*2b9.*0d*0aFoolproof*3a*20its*20output*20only*20contains*20characters*20that*20aVunaffectQby9*2fdecodZ.*20TheVis*20no*20risk*20of*20missZ*20a9*2fdecodZ*20pass*2c*20or*20of*20messZ*20up*20a*20JSURL*20strZ*20by*20applyZ*20an*20extra9*20or*20decodZ*20pass.*0d*0aEasy*20to*20generate8parse*0d*0aSyntax*0d*0a*0d*0aThink*20of*20it*20as1*20with*20the*20followZ*20changes*3a*0d*0a*0d*0aCurly*20bracG*28*7b8*7d*29*20replacQby*20parenthesG*28*288*29*29*0d*0aSquaVbrackets*20*28*5b8*5d*29*20replacQby*20*28*7e8*29*0d*0aProperty*20namGunquotQ*28but*20escapQ--*20see*20below*29.*0d*0aStrZ*20valuGprefixQby*20a*20sZle*20quote*20*28*27*298escaped*0d*0aAll*20other1*20punctuation*20*28colon*20*3a8comma*20*2c*29*20replacQby*20tildG*28*7e*29*0d*0aAn*20extra*20tilde*20*28*7e*29*20at*20the*20very*20beginnZ.*0d*0aProperty*20names8strZ*20valuGaVescapQas*20follows*3a*0d*0a*0d*0aLetters*2c*20digits*2c*20underscoV*28_*29*2c*20hyphen*20*28-*298dot*20*28.*29*20aVpreserved.*0d*0aDollar*20sign*20*28!*29WreplacQby*20exclamation*20mark*20*28*21*29*0d*0aOther*20characters*20with*20UNICODE*20value*20*3c*3d*200xff*20aVencodQas*20*2aXX*0d*0aCharacters*20with*20UNICODE*20value*20*3e*200xff*20aVencodQas*20*2a*2aXXXX*0d*0aExamples*0d*0a*0d*0aJSON*3a*0d*0a*0d*0a*7b*22name*22*3a*22John*20Doe*22*2c*22age*22*3a42*2c*22children*22*3a*5b*22Mary*22*2c*22Bill*22*5d*7d*0d*0aJSON*20*2b9*3a*0d*0a*0d*0a*257BKnameK*253AKJohn*2520DoeK*252CKageK*253A42*252CKchildrenK*253A*255BKMaryK*252CKBillK*255D*257D*0d*0aJSURL*3a*0d*0a*0d*0a*7e*28name*7e*27John*2a20Doe*7eage*7e42*7echildren*7e*28*7e*27Mary*7e*27Bill*29*29*0d*0a~Z~'ing~Q~'ed*20~K~'*2522~V~'re*20~Y~'*20moVcompact*20than~G~'es*20~W~'*20is*20)") {
              done()
            } else {
              done("string not right")
            }
          })
        })
      })
    </script>
  </body>
</html>
